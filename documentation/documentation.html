<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Testing Automation in an Embedded Linux Project</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html --> 
<meta name="src" content="documentation.tex"> 
<meta name="date" content="2015-12-22 15:50:00"> 
<link rel="stylesheet" type="text/css" href="documentation.css"> 
</head><body 
>
   <div class="maketitle">
                                                                                    

                                                                                    
                                                                                    

                                                                                    

<h2 class="titleHead">Testing Automation in an Embedded Linux Project</h2>
 <div class="author" > <span 
class="ecrm-1200">Topi Kuutela</span><br /></div><br />
<div class="date" ><span 
class="ecrm-1200">December 22, 2015</span></div>
   </div>
                                                                                    

                                                                                    
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">Start here</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.1 <a 
href="#x1-30001.1" id="QQ2-1-4">Simple setup</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.2 <a 
href="#x1-40001.2" id="QQ2-1-5">Testing automation USB-stick</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.3 <a 
href="#x1-50001.3" id="QQ2-1-6">SSH-keys</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.4 <a 
href="#x1-60001.4" id="QQ2-1-7">Foreword</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-70002" id="QQ2-1-8">Testing harness</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-140003" id="QQ2-1-15">AFT - Automated Flasher Tester</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.1 <a 
href="#x1-150003.1" id="QQ2-1-16">PC-devices</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.2 <a 
href="#x1-160003.2" id="QQ2-1-17">Gadget-devices</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-170004" id="QQ2-1-18">PEM - Peripheral EMulator</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.1 <a 
href="#x1-180004.1" id="QQ2-1-19">Creation of a PEM-Arduino</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.2 <a 
href="#x1-190004.2" id="QQ2-1-20">Usage instructions</a></span>
<br />   <span class="sectionToc" >5 <a 
href="#x1-200005" id="QQ2-1-21">Power cutters</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.1 <a 
href="#x1-210005.1" id="QQ2-1-22">Cleware powercutters</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.2 <a 
href="#x1-220005.2" id="QQ2-1-23">USB-relays</a></span>
<br />   <span class="sectionToc" >6 <a 
href="#x1-230006" id="QQ2-1-24">Gigabyte GB-BXBT-3825</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.1 <a 
href="#x1-240006.1" id="QQ2-1-25">CI-integration</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.2 <a 
href="#x1-250006.2" id="QQ2-1-27">Debian on Gigabyte</a></span>
<br />   <span class="sectionToc" >7 <a 
href="#x1-260007" id="QQ2-1-28">MinnowBoard MAX</a></span>
<br />   &#x00A0;<span class="subsectionToc" >7.1 <a 
href="#x1-270007.1" id="QQ2-1-29">CI-integration</a></span>
<br />   &#x00A0;<span class="subsectionToc" >7.2 <a 
href="#x1-280007.2" id="QQ2-1-31">Flashing the BIOS on MinnowBoard MAX</a></span>
<br />   &#x00A0;<span class="subsectionToc" >7.3 <a 
href="#x1-290007.3" id="QQ2-1-32">Debian on MinnowBoard MAX</a></span>
<br />   <span class="sectionToc" >8 <a 
href="#x1-300008" id="QQ2-1-33">Galileo Gen 2</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.1 <a 
href="#x1-310008.1" id="QQ2-1-34">BIOS</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.2 <a 
href="#x1-320008.2" id="QQ2-1-35">CI-integration</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.3 <a 
href="#x1-330008.3" id="QQ2-1-37">Debian on Galileo Gen 2</a></span>
<br />   <span class="sectionToc" >9 <a 
href="#x1-380009" id="QQ2-1-42">Intel Edison</a></span>
<br />   &#x00A0;<span class="subsectionToc" >9.1 <a 
href="#x1-390009.1" id="QQ2-1-43">USB-interfaces</a></span>
<br />   &#x00A0;<span class="subsectionToc" >9.2 <a 
href="#x1-400009.2" id="QQ2-1-44">CI-integration</a></span>
<br />   <span class="sectionToc" >A <a 
href="#x1-41000A" id="QQ2-1-46">AFT implementation details</a></span>
<br />   &#x00A0;<span class="subsectionToc" >A.1 <a 
href="#x1-42000A.1" id="QQ2-1-47">Configuration</a></span>
<br />   &#x00A0;<span class="subsectionToc" >A.2 <a 
href="#x1-48000A.2" id="QQ2-1-53">Classes and files</a></span>
<br />   <span class="sectionToc" >B <a 
href="#x1-60000B" id="QQ2-1-65">AFT without root privileges</a></span>
   </div>
                                                                                    

                                                                                    
<!--l. 44--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>Start here</h3>
<!--l. 46--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                    

                                                                                    
<a 
 id="x1-20011"></a>
                                                                                    

                                                                                    

<!--l. 48--><p class="noindent" ><img 
src="minnowwiring.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1: </span><span  
class="content">MinnowBoard MAX wiring diagram</span></div><!--tex4ht:label?: x1-20011 -->
                                                                                    

                                                                                    
<!--l. 50--><p class="noindent" ></div><hr class="endfigure">
   <h4 class="subsectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001.1"></a>Simple setup</h4>
<!--l. 53--><p class="noindent" >The absolutely mandatory steps to take for a simplest working system with just MinnowBoard MAX
platform are as follows:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Copy the content of Testing automation USB-stick from ta-usb-stick branch in the AFT
     git repository to a suitable USB-stick.
     <!--l. 57--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>At the time of writing, the location is temporary and doesn&#8217;t include pre-made
     Debian images due to their size.
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Setup a Testing harness as instructed in section <a 
href="#x1-70002">2<!--tex4ht:ref: testingharness --></a>
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Pick  a  Cleware  powercutter  and  using  the  instructions  on  section  <a 
href="#x1-210005.1">5.1<!--tex4ht:ref: clewarecutters --></a>,  install  the
     associated software.
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Setup AFT as instructed in section <a 
href="#x1-140003">3<!--tex4ht:ref: aft --></a>
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Setup PEM as instructed in section <a 
href="#x1-170004">4<!--tex4ht:ref: pem --></a>
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">Create an Arduino keyboard emulator using the instructions in <a 
href="#x1-180004.1">4.1<!--tex4ht:ref: pemarduino --></a>
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">Using <span 
class="ectt-1095">dd </span>create a bootable Debian USB-stick for MinnowBoard MAX as instructed in
     section <a 
href="#x1-150003.1">3.1<!--tex4ht:ref: pc --></a>.
     </dd><dt class="enumerate-enumitem">
   8. </dt><dd 
class="enumerate-enumitem">Following  instructions  in  the  first  two  subsections  of  section  <a 
href="#x1-260007">7<!--tex4ht:ref: minnowboard --></a>,  set  up  the  testing
     hardware.
     </dd><dt class="enumerate-enumitem">
   9. </dt><dd 
class="enumerate-enumitem">Configure AFT using the instructions from appendix <a 
href="#x1-41000A">A<!--tex4ht:ref: app:aft --></a>.</dd></dl>
<!--l. 68--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-40001.2"></a>Testing automation USB-stick</h4>
<!--l. 69--><p class="noindent" >In this document there are multiple references to a testing automation USB-stick. This stick is
intended to contain programs and other tools required for maintaining a complete testing
automation system.
<!--l. 71--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>At the time of writing, the location is temporary and doesn&#8217;t include pre-made Debian
images due to their size.
<!--l. 73--><p class="indent" >   The content can be downloaded from ta-usb-stick branch in the AFT git repository and copied to
any suitably large USB-stick.
                                                                                    

                                                                                    
<!--l. 75--><p class="indent" >   The content was bundled together during the creation of this document, in December 2015.
Therefore the programs may be out of date.
<!--l. 77--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.3   </span> <a 
 id="x1-50001.3"></a>SSH-keys</h4>
<!--l. 78--><p class="noindent" >In the testing automation system SSH-keys are used extensively for authentication. A default
SSH-key is included in the testing automation USB-key in folders <span 
class="ectt-1095">gigabyte </span>and <span 
class="ectt-1095">minnowboard</span>.
Additionally, the SSH-key is added to the <span 
class="ectt-1095">root.ssh </span>folder in each pre-made Debian image. <span 
class="ecbx-1095">It is</span>
<span 
class="ecbx-1095">highly recommended that these SSH-keys are replaced with your own ones! </span>Leaving the
default keys in place may expose your system to attacks.
<!--l. 80--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.4   </span> <a 
 id="x1-60001.4"></a>Foreword</h4>
<!--l. 81--><p class="noindent" >This document was originally written over November and December 2015 to relay information
regarding testing automation setup in an embedded Linux project. The level of detail is intentionally
high to allow the next operator to understand all details of the system.
<!--l. 83--><p class="indent" >   This document covers the configuration and construction instructions only for the testing
automation part of the continuous integration system used in the project. The testing
automation subsystem is not coupled to the build infrastructure other than by the image
transmission.
<!--l. 85--><p class="indent" >   In the first section the configuration and installation of the testing harness, the testing server, is
covered. In the second and third sections the usage of the most important pieces of software are
detailed. In section 5 the different kinds of power cutter devices are explained and their associated
software is explained. In sections 6-9 the individual testing platforms are described. Finally,
in the appendices, the AFT implementation details and privilege reduction options are
explained.
<!--l. 87--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-70002"></a>Testing harness</h3>
<!--l. 89--><p class="noindent" >The testing server is, in this document, called testing harness. The testing harness is responsible of
fetching the images from the source and executing AFT to flash the images on various target
devices. The system has been tested using <span 
class="ecti-1095">OpenSUSE 13.2</span>.
<!--l. 91--><p class="indent" >   The testing harness acts to the testable devices as a network file system server, and as a
DHCP-server. It is highly recommended that the devices are put in an isolated network.
<!--l. 93--><p class="indent" >   Testable images can be copied from the builders using many means. Both NFS and standard IP
transmission using <span 
class="ectt-1095">wget </span>have been tested and found reliable. Because the images are most likely
copied over Ethernet, and the testable devices are in a separate network, the testing harness must
have two network cards.
<!--l. 95--><p class="indent" >   In the following section the configuration is detailed. The commands are expected to be
run using <span 
class="ectt-1095">root </span>privileges. A fresh installation of OpenSUSE 13.2 with SSH-server, no
desktop environment and working internet connectivity are assumed. Firewall configuration
is not provided, it is recommended that the testing harness is only kept in a trusted
network.
                                                                                    

                                                                                    
<!--l. 97--><p class="indent" >   Configuration of AFT is explained in appendix <a 
href="#x1-41000A">A<!--tex4ht:ref: app:aft --></a>.
<!--l. 99--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-80002"></a>Base system</h4>
<!--l. 100--><p class="noindent" >A set of common tools and utilities: <!--l. 101-->
<div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-8001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">zypper</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">install</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gcc</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gcc</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">c</span><span 
class="ecrm-0600">++</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">make</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">automake</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cmake</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">autoconf</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">man</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">emacs</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nano</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">screen</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">tree</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">attr</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dnsmasq</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gdisk</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nfs</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">kernel</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">server</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">setuptools</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">devel</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">tk</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">idle</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ipython</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">libusb</span><span 
class="ecrm-0600">-1</span><span 
class="ecrm-0600">_0</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">devel</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usbutils</span>
   </div>
<!--l. 105--><p class="indent" >   OpenSUSE comes with <span 
class="ectt-1095">YaST </span>configuration utility. It can be used to configure most base OS
options. Using <span 
class="ectt-1095">yast </span>configure:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">The  secondary  Ethernet  card  to  have  static  IP  <span 
class="ectt-1095">192.168.30.1</span>,  and  subnet  mask
     <span 
class="ectt-1095">255.255.255.0</span>
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Create user <span 
class="ectt-1095">tester </span>and add it to <span 
class="ectt-1095">wheel </span>group</dd></dl>
<!--l. 110--><p class="noindent" >The secondary local area network is used for the flashing of PC-devices <a 
href="#x1-150003.1">3.1<!--tex4ht:ref: pc --></a>. The <span 
class="ectt-1095">tester</span>&#8217;s home will be
set as shared folder over NFS for the <span 
class="ectt-1095">192.168.30.0/24 </span>network. The <span 
class="ectt-1095">tester </span>is also the
recommended user for automated testing.
<!--l. 112--><p class="indent" >   Enable <span 
class="ectt-1095">wheel </span>group as passwordless sudoers. Using <span 
class="ectt-1095">visudo </span>add to the end of the <span 
class="ectt-1095">/etc/sudoers</span>
file: <!--l. 113-->
<div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-8004r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">%</span><span 
class="ecrm-0600">wheel</span><span 
class="ecrm-0600">ALL</span><span 
class="ecrm-0600">=(</span><span 
class="ecrm-0600">ALL</span><span 
class="ecrm-0600">)</span><span 
class="ecrm-0600">NOPASSWD</span><span 
class="ecrm-0600">:</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ALL</span>
   </div>
<!--l. 117--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-90002"></a>DFU-util</h4>
<!--l. 120--><p class="noindent" >Flashing Edison requires the installation of <span 
class="ectt-1095">dfu-util </span>program. Dfu-util takes care of the
DFU-protocol and the flashing of each partition on the target device.
<!--l. 122--><p class="indent" >   At the time of writing (24.11.2015) the official latest version of DFU-util does not have a working
USB-tree support. Fortunately a patch has been made, and the installation is therefore
straightforward.
   <!--l. 124-->
<div class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-9001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">clone</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">://</span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">code</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">sf</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">net</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">p</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dfu</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">util</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dfu</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">util</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dfu</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">util</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">src</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9002r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dfu</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">util</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">src</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9003r3"></a><span 
class="ecrm-0600">3</span></span><span 
class="ecrm-0600">wget</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">http</span><span 
class="ecrm-0600">://</span><span 
class="ecrm-0600">sourceforge</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">net</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">p</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dfu</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">util</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">tickets</span><span 
class="ecrm-0600">/6/</span><span 
class="ecrm-0600">attachment</span><span 
class="ecrm-0600">/0001-</span><span 
class="ecrm-0600">Fix</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">reimplement</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">USBPATH</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">support</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">patch</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9004r4"></a><span 
class="ecrm-0600">4</span></span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">am</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">0001</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9005r5"></a><span 
class="ecrm-0600">5</span></span><span 
class="ecrm-0600">./</span><span 
class="ecrm-0600">autogen</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9006r6"></a><span 
class="ecrm-0600">6</span></span><span 
class="ecrm-0600">./</span><span 
class="ecrm-0600">configure</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9007r7"></a><span 
class="ecrm-0600">7</span></span><span 
class="ecrm-0600">make</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-9008r8"></a><span 
class="ecrm-0600">8</span></span><span 
class="ecrm-0600">make</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">install</span>
   </div>
<!--l. 135--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-100002"></a>Clewarecontrol</h4>
<!--l. 136--><p class="noindent" >Clewarecontrol utility is used to control the power cutters made by Cleware GmbH. At the time of
writing, the latest clewarecontrol, version 4.1, was broken. Therefore the version 2.8 is
recommended.
<!--l. 138--><p class="indent" >   To install clewarecontrol commandline utility: <!--l. 139-->
                                                                                    

                                                                                    
<div class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-10001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">wget</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">https</span><span 
class="ecrm-0600">://</span><span 
class="ecrm-0600">www</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">vanheusden</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">com</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">clewarecontrol</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">clewarecontrol</span><span 
class="ecrm-0600">-2.8.</span><span 
class="ecrm-0600">tgz</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-10002r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">tar</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">xvf</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">clewarecontrol</span><span 
class="ecrm-0600">-2.8.</span><span 
class="ecrm-0600">tgz</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-10003r3"></a><span 
class="ecrm-0600">3</span></span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">clewarecontrol</span><span 
class="ecrm-0600">-2.8</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-10004r4"></a><span 
class="ecrm-0600">4</span></span><span 
class="ecrm-0600">make</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-10005r5"></a><span 
class="ecrm-0600">5</span></span><span 
class="ecrm-0600">make</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">install</span>
   </div>
<!--l. 147--><p class="indent" >   Usage instructions are given in the section <a 
href="#x1-200005">5<!--tex4ht:ref: powercutters --></a>.
<!--l. 149--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-110002"></a>Dnsmasq</h4>
<!--l. 150--><p class="noindent" ><span 
class="ectt-1095">Dnsmasq </span>is used as a DHCP-server for the PC-devices. It also provides a table with
MAC-to-IP-address conversion. Dnsmasq is configured to provide IP-addresses to the
<span 
class="ectt-1095">192.168.30.0/24 </span>subnet, to all devices connected (through a switch) to the secondary Ethernet
port.
<!--l. 152--><p class="indent" >   Add the following lines to <span 
class="ectt-1095">/etc/dnsmasq.conf </span>file: <!--l. 153-->
<div class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-11001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dhcp</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">range</span><span 
class="ecrm-0600">=192.168.30.2,192.168.30.254,10</span><span 
class="ecrm-0600">m</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-11002r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">interface</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">p1p1</span>
   </div>
<!--l. 157--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>replace the <span 
class="ectt-1095">p1p1 </span>with the network interface the PC-devices are connected
to.
<!--l. 159--><p class="indent" >   To enable dnsmasq service: <!--l. 160-->
<div class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-11003r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">systemctl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">start</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dnsmasq</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">service</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-11004r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">systemctl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">enable</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dnsmasq</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">service</span>
   </div>
<!--l. 164--><p class="indent" >   If at some point the DHCP-exchange has to be debugged, stop the Systemd-service and start
dnsmasq manually using: <!--l. 165-->
<div class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-11005r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">systemctl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">stop</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dnsmasq</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">service</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-11006r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">dnsmasq</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">no</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">daemon</span>
   </div>
<!--l. 170--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-120002"></a>Network File System</h4>
<!--l. 171--><p class="noindent" >Network file system (NFS) is used to share the images and other files used in flashing for PC-devices.
By convention the whole <span 
class="ectt-1095">/home/tester </span>is shared.
<!--l. 173--><p class="indent" >   To share the folder, add the following line to <span 
class="ectt-1095">/etc/exports</span>: <!--l. 174-->
<div class="lstlisting" id="listing-8"><span class="label"><a 
 id="x1-12001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">home</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">tester</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">192.168.0.0/16(</span><span 
class="ecrm-0600">crossmnt</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">ro</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">root_squash</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">sync</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">no_subtree_check</span><span 
class="ecrm-0600">)</span>
   </div>
<!--l. 178--><p class="indent" >   Then enable the Systemd-service: <!--l. 179-->
<div class="lstlisting" id="listing-9"><span class="label"><a 
 id="x1-12002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">systemctl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">start</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nfs</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">server</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">service</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-12003r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">systemctl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">enable</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nfs</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">server</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">service</span>
   </div>
<!--l. 183--><p class="indent" >   On some platforms, also <span 
class="ectt-1095">rpcbind.service </span>has to be activated.
                                                                                    

                                                                                    
<!--l. 185--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-130002"></a>Udev (optional)</h4>
<!--l. 186--><p class="noindent" >It is recommended to set udev-rules to create symbolic links from a human-readable file name to
ttyUSB-devices used for PEM (section <a 
href="#x1-170004">4<!--tex4ht:ref: pem --></a>), serial output recording (appendix <a 
href="#x1-41000A">A<!--tex4ht:ref: app:aft --></a>) and to the
USB-relay powercutters used for Edisons. The USB-to-serial adapters are often unreliable and tend
to occasionally reset, which causes a re-initialization by Linux kernel. This also triggers a
(re-)creation of the ttyUSB-device created by udev.
<!--l. 188--><p class="indent" >   The recommended way to set the rules is by adding rules to, for example, <br 
class="newline" /><span 
class="ectt-1095">/etc/udev/rules.d/99-persistent-ttyusb</span>. A rule can look for example like: <!--l. 189-->
<div class="lstlisting" id="listing-10"><span class="label"><a 
 id="x1-13001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">SUBSYSTEM</span><span 
class="ecrm-0600">=="</span><span 
class="ecrm-0600">tty</span><span 
class="ecrm-0600">",</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ENV</span><span 
class="ecrm-0600">{</span><span 
class="ecrm-0600">ID_PATH</span><span 
class="ecrm-0600">}=="</span><span 
class="ecrm-0600">pci</span><span 
class="ecrm-0600">-0000:00:1</span><span 
class="ecrm-0600">d</span><span 
class="ecrm-0600">.7-</span><span 
class="ecrm-0600">usb</span><span 
class="ecrm-0600">-0:1.1.3:1.0",</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">SYMLINK</span><span 
class="ecrm-0600">+="</span><span 
class="ecrm-0600">gigabytearduino3</span><span 
class="ecrm-0600">"</span>
   </div>
<!--l. 192--><p class="indent" >   The <span 
class="ectt-1095">SUBSYSTEM </span>is the udev subsystem which is used by the target device, the <span 
class="ectt-1095">SYMLINK </span>is the
name of the symbolic link created under <span 
class="ectt-1095">/dev</span>, and the <span 
class="ectt-1095">ID_PATH </span>is used to filter the specific device.
To retrieve the ID_PATH, plug in the device, find the correct <span 
class="ectt-1095">ttyUSBX </span>device using e.g. <span 
class="ectt-1095">dmesg </span>and
execute: <!--l. 193-->
<div class="lstlisting" id="listing-11"><span class="label"><a 
 id="x1-13002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">udevadm</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">info</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">ttyUSBX</span>
   </div>
<!--l. 197--><p class="indent" >   After setting the rules, udev must be refreshed using <!--l. 198-->
<div class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-13003r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">udevadm</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">trigger</span>
   </div>
<!--l. 202--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>Setting the rules using this method allows unplugging and re-plugging USB-cables to the
same port, or rebooting the testing harness without re-configuring AFT. Otherwise the
ttyUSB-device may change!
<!--l. 204--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-140003"></a>AFT - Automated Flasher Tester</h3>
<!--l. 207--><p class="noindent" >AFT is a Python tool to flash the testable image to various kinds of devices. AFT tries to guarantee
that the device under test is in a state where:
     <ul class="itemize1">
     <li class="itemize">The device can be rebooted and the image under test starts again.
     </li>
     <li class="itemize">The device under test can be accessed over SSH without a password.</li></ul>
<!--l. 213--><p class="indent" >   To achieve the first requirement, AFT flashes the image to the primary boot media of
the device under test, and possibly modifies the BIOS settings to use that as the boot
media.
<!--l. 215--><p class="indent" >   The second requirement is achieved by injecting a known public SSH-key to
<span 
class="ectt-1095">&#x003C;root home&#x003E;/.ssh/authorized_keys</span>. This allows the owner of the corresponding private key to
connect the device without a password. AFT may also modify the network settings of the testing
harness to make sure the device is still accessible after a reboot.
<!--l. 217--><p class="indent" >   Finally AFT starts the pre-configured tests by executing either its internal test cases or by
starting a subprocess. The test cases are assumed not to modify the BIOS settings. For this AFT has
an integrated test runner which executes test plans based on configuration.
                                                                                    

                                                                                    
<!--l. 219--><p class="indent" >   Because flashing often requires multiple boots during the process, and the only guaranteed way
to power off a device is to cut its power, different kinds of external power cutters are
used.
<!--l. 221--><p class="indent" >   The execution syntax for AFT is <!--l. 222-->
<div class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-14001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">aft</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;</span><span 
class="ecrm-0600">machinetype</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;</span><span 
class="ecrm-0600">imagefile</span><span 
class="ecrm-0600">&#x003E;</span>
   </div>
<!--l. 225--><p class="indent" >   where, at the time of writing, the options for <span 
class="ectt-1095">machinetype </span>are <span 
class="ectt-1095">gigabyte</span>, <span 
class="ectt-1095">galileov2</span>,
<span 
class="ectt-1095">minnowboardmax </span>and <span 
class="ectt-1095">edison</span>. The imagefile is the image to be tested.
<!--l. 227--><p class="indent" >   Optionally, AFT can also record the serial console output to file by using <span 
class="ectt-1095">--record </span>argument,
assuming the serial device has been configured properly. This allows some level of logging even if the
device fails to boot.
<!--l. 229--><p class="indent" >   Details to the configuration of AFT is given in the appendix <a 
href="#x1-41000A">A<!--tex4ht:ref: app:aft --></a>. In the same appendix there is a a
general overview to the classes involved and implementation details.
<!--l. 231--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-150003.1"></a>PC-devices</h4>
<!--l. 233--><p class="noindent" >PC-like devices are devices which have a network interface with a fixed MAC-address and usually
have a some sort of BIOS/EFI menu.
<!--l. 235--><p class="indent" >   PC-like devices are flashed with the aid of a <span 
class="ecti-1095">support image</span>, a Linux image which can boot the
device under test. The support image is used to copy the target image over NFS to the primary boot
media, and to add e.g. the SSH-key to it.
<!--l. 237--><p class="indent" >   The BIOS settings are modified using PEM, an Arduino UNO device with a keyboard emulating
firmware. See section <a 
href="#x1-170004">4<!--tex4ht:ref: pem --></a> for further information.
<!--l. 239--><p class="indent" >   The biggest hurdle with PC-devices is usually the creation of a support image. The distribution
used on this guide is Debian 8.2 because it supports out of the box a wide range of architectures and
is generally known to be compatible with many kinds of devices. In simple cases the support image
creation is just a matter of installing the operating system to a USB stick. In worse cases, e.g. with
Galileo Gen 2, it requires the creation of custom kernel with board specific <span 
class="ecti-1095">Board Support Package</span>
(BSP).
<!--l. 241--><p class="indent" >   Support images for all currently supported devices are provided on the testing automation
USB-stick.
<!--l. 243--><p class="indent" >   By using a support image to also modify the target image, AFT can be run without root
privileges. <span 
class="ectt-1095">Mount</span>-command for modifying images and mount points always requires root privileges,
but this is executed only on the support image. Unfortunately gadget-devices require
the modification of the image on the testing harness, so this is not viable in the general
case.
<!--l. 245--><p class="indent" >   PC-devices usually use some kind of a power supply which is connected to the mains
powerlines. Therefore a natural place for a power cutter is in between the mains and the
PSU.
<!--l. 247--><p class="indent" >   Another option would be to strip the positive line between the PSU and the device, and install a
power cutter in between. This is considered a worse solution because it requires more customization
of the hardware.
<!--l. 249--><p class="indent" >   The PC-devices described in this document include Gigabyte <a 
href="#x1-230006">6<!--tex4ht:ref: gigabyte --></a>, MinnowBoard MAX <a 
href="#x1-260007">7<!--tex4ht:ref: minnowboard --></a> and
Galileo Gen 2 <a 
href="#x1-300008">8<!--tex4ht:ref: galileo --></a>.
                                                                                    

                                                                                    
<!--l. 251--><p class="indent" >   A support image is provided on the Testing automation USB-stick for each platform in the folder
<span 
class="ectt-1095">debian-images</span>. These can be copied to another USB-stick using e.g. <!--l. 252-->
<div class="lstlisting" id="listing-14"><span class="label"><a 
 id="x1-15001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">if</span><span 
class="ecrm-0600">=&#x003C;</span><span 
class="ecrm-0600">USB</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">&#x003E;/</span><span 
class="ecrm-0600">debian</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">images</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">minnowUSB</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">image</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">of</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sdX</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bs</span><span 
class="ecrm-0600">=8</span><span 
class="ecrm-0600">M</span>
   </div>
<!--l. 255--><p class="indent" >   where the <span 
class="ectt-1095">sdX </span>refers to the block device you want to copy the image to.
<!--l. 257--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-160003.2"></a>Gadget-devices</h4>
<!--l. 259--><p class="noindent" >Gadget-like devices are devices which are closer to a mobile phone or a traditional embedded MCU
or SoC. These are often flashed using the DFU-protocol.
<!--l. 261--><p class="indent" >   There are several DFU programmer utilities and flashing a device completely may require
separate flashing calls to flash each memory media on the device. Depending on the flashing utility,
it may be possible to detect errors during flashing. These shouldn&#8217;t cause a failure in testing but
instead just initiate another attempt at flashing.
<!--l. 263--><p class="indent" >   Depending on the device, switching power on and off can be considerably more difficult with a
gadget-device. If the testable device has an internal battery, it most likely requires somewhat
complicated custom hardware to power cycle it. With gadget-devices extra care must be taken in the
prevention of floating ground issues. If the device is powered over USB, a powered USB-hub is
almost certainly required.
<!--l. 265--><p class="indent" >   The only gadget-device in this document is the Intel Edison <a 
href="#x1-380009">9<!--tex4ht:ref: edison --></a>, which uses dfu-util (<a 
href="#x1-90002">2<!--tex4ht:ref: dfuutil --></a>) for flashing
and a USB-relay as a power cutter.
<!--l. 267--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-170004"></a>PEM - Peripheral EMulator</h3>
<!--l. 270--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>The instructions work only on Arduino UNO!
<!--l. 272--><p class="indent" >   Peripheral Emulator is a device created out of an Arduino UNO and USB-to-serial adapter for
emulating a keyboard or another peripheral device. To be compatible with the PC 97 standard, and
especially BIOS mode, the firmware supports 6-key-rollover.
<!--l. 274--><p class="indent" >   PEM works by flashing both the Atmega 328U and Atmega 16U2 chips on the Arduino UNO R3
board.
<!--l. 276--><p class="indent" >   The Atmega 328U is flashed with a firmware that takes care of the communication between the
testing harness and the USB-to-serial adapter. The firmware receives keyboard states from the
testing harness over serial data line and responds with an acknowledgement after each successful
packet.
<!--l. 278--><p class="indent" >   The Atmega 16U2 is converted from its original USB-to-serial mode to an actual 6KRO
HID-emulator. The 16U2 receives the packets from the 328U, interprets them and sends them over
the USB-interface using HID protocol.
<!--l. 280--><p class="indent" >   PEM can be installed by issuing the following commands: <!--l. 281-->
<div class="lstlisting" id="listing-15"><span class="label"><a 
 id="x1-17001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">clone</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">https</span><span 
class="ecrm-0600">://</span><span 
class="ecrm-0600">github</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">com</span><span 
class="ecrm-0600">/01</span><span 
class="ecrm-0600">org</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">AutomatedFlasherTester</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">pem</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-17002r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">pem</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-17003r3"></a><span 
class="ecrm-0600">3</span></span><span 
class="ecrm-0600">sudo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">setup</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">py</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">install</span>
   </div>
<!--l. 286--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>PEM installation files are also included in the Testing automation USB-stick in the
<span 
class="ectt-1095">installationfiles </span>folder.
                                                                                    

                                                                                    
<!--l. 288--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-180004.1"></a>Creation of a PEM-Arduino</h4>
<!--l. 290--><p class="noindent" >The creation of a PEM-Arduino requires
     <ul class="itemize1">
     <li class="itemize">An Arduino UNO R3
     </li>
     <li class="itemize">USB-to-serial adapter
     </li>
     <li class="itemize">3 wires to connect the USB-to-serial adapter to Arduino
     </li>
     <li class="itemize">A jumper or a piece of wire
     </li>
     <li class="itemize">USB A to USB B cable
     </li>
     <li class="itemize">USB A to mini/microUSB (depending on the USB-to-serial adapter)</li></ul>
<!--l. 300--><p class="indent" >   The programs required are the Arduino IDE 1.6: (<a 
href="https://www.arduino.cc/en/Main/Software" class="url" ><span 
class="ectt-1095">https://www.arduino.cc/en/Main/Software</span></a>)
and dfu-programmer 0.62: (<a 
href="https://dfu-programmer.github.io/" class="url" ><span 
class="ectt-1095">https://dfu-_programmer.github.io/</span></a>).
<!--l. 303--><p class="indent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Plug the Arduino UNO to your computer using the USB-B to USB-A connector.
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Start the Arduino IDE. Select the correct port in the <span 
class="ectt-1095">Tools-&#x003E;Port </span>menu. Open the
     <span 
class="ectt-1095">&#x003C;PEM git repository&#x003E;/src/pem_Arduino/pem_Arduino.ino</span>. Flash the sketch in the
     Arduino. Close the IDE.
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">With the Arduino connected to computer (and powered), connect briefly using a jumper
     or a piece of wire the two pins closest to the Arduino&#8217;s USB-B port. This resets
     the Atmega 16U2. Now you should be able to get (scrambled) output by issuing:
     <!--l. 308-->
     <div class="lstlisting" id="listing-16"><span class="label"><a 
 id="x1-18004r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">sudo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dfu</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">programmer</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">atmega16u2</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dump</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">The firmware for the 16U2 is included in the testing automation USB-stick but it can also be downloaded
     from <a 
href="http://hunt.net.nz/users/darran/weblog/b3029/Arduino_UNO_Keyboard_HID_version_03.html" class="url" ><span 
class="ectt-1095">http://hunt.net.nz/users/darran/weblog/b3029/Arduino_UNO_Keyboard_HID_version_03.html</span></a>.
     To flash the firmware, in the testing automation USB stick folder <span 
class="ectt-1095">arduinokb</span>, issue the
     following command: <!--l. 313-->
     <div class="lstlisting" id="listing-17"><span class="label"><a 
 id="x1-18006r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">sudo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">sh</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">flash</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">sh</span>
     
     </div>
     <!--l. 316--><p class="noindent" >This script first erases the 16U2, then flashes the firmware and then resets the
     chip.
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">To verify that the system works, see the usage instructions in the following subsection.</dd></dl>
<!--l. 321--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-190004.2"></a>Usage instructions</h4>
<!--l. 322--><p class="noindent" >PEM has a graphical user interface for recording keyboard sequences. To make the keyboard
sequence as reliable as possible, it is good idea to use constant intervals between the
key presses. Additionally, most BIOS menus support e.g. PageUp and PageDown keys
which move the cursor to the top or the bottom of the list (that is, to a known, fixed
location).
<!--l. 324--><p class="indent" >   When using the peripheral emulator, connect the USB-to-serial to your testing harness or
recording computer using the mini/microUSB connector. Connect the USB-to-serial pins to
corresponding Arduino pins: <span 
class="ectt-1095">TX =&#x003E; 10</span>, <span 
class="ectt-1095">RX =&#x003E; 11 </span>and <span 
class="ectt-1095">GND =&#x003E; GND</span>.
<!--l. 326--><p class="indent" >   When PEM is started, it doesn&#8217;t start sending the key presses before the target device can detect
them. This is achieved by waiting for the Arduino to boot up. Arduino is powered by the USB-B
line, and therefore gets the power when the target device boots. Because the device under test power
is controlled using a mains power cutter, in production, the PEM starts sending the key presses only
exactly when the device boots.
<!--l. 328--><p class="indent" >   To start the recording interface, use <!--l. 329-->
<div class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-19001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">sudo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">pem</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">interface</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">serialconnection</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">record</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;</span><span 
class="ecrm-0600">target_file</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">port</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">ttyUSBX</span><span 
class="ecrm-0600">&#x003E;</span>
   </div>
<!--l. 332--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>replace the <span 
class="ectt-1095">/dev/ttyUSBX </span>with the <span 
class="ectt-1095">ttyUSB</span>-device corresponding to the USB-to-serial
adapter, which can be found using e.g. <span 
class="ectt-1095">dmesg</span>.
<!--l. 334--><p class="indent" >   In the recording interface, to start recording a sequence, press the <span 
class="ectt-1095">Start </span>button. After that, each
key press sent to the PEM UI gets sent to the target device. To stop recording and to
save the last recording to the file given in the command line arguments, press the <span 
class="ectt-1095">Stop</span>
button.
<!--l. 336--><p class="indent" >   To clean up the keyboard sequence, a LibreOffice Calc spreadsheet is provided on the testing
automation USB-stick at <span 
class="ectt-1095">&#x003C;USB-root&#x003E;/arduinokb/sequence-editor.ods</span>.
<!--l. 338--><p class="indent" >   To execute a keyboard sequence, use the following command <!--l. 339-->
<div class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-19002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">sudo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">pem</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">interface</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">serialconnection</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">playback</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;</span><span 
class="ecrm-0600">playback_file</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">port</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">ttyUSBX</span><span 
class="ecrm-0600">&#x003E;</span>
   </div>
<!--l. 343--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-200005"></a>Power cutters</h3>
<!--l. 345--><p class="noindent" >Controlling the power on the target devices is always done using a power cutter in the power line.
Power cutters are used because powering off cleanly is not reliable. In some PC-devices, the
USB-ports also remain powered unless the power is completely cut off.
                                                                                    

                                                                                    
<!--l. 347--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.1   </span> <a 
 id="x1-210005.1"></a>Cleware powercutters</h4>
<!--l. 349--><p class="noindent" >In our setup we have used two kinds of power cutters: for PC-devices, power switches by Cleware
GmbH are used. Cleware cutters are controlled over USB using a command line tool
<span 
class="ectt-1095">clewarecontrol</span>. At the time of writing, the latest version of <span 
class="ectt-1095">clewarecontrol</span>, 4.1, is unstable at
least on Linux Fedora 22. It is recommended to use the version 2.8.
<!--l. 351--><p class="indent" >   The cutters can be listed by issuing <!--l. 352-->
<div class="lstlisting" id="listing-20"><span class="label"><a 
 id="x1-21001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">clewarecontrol</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">l</span>
   </div>
<!--l. 356--><p class="indent" >   A switch can be turned on and off using the following command <!--l. 357-->
<div class="lstlisting" id="listing-21"><span class="label"><a 
 id="x1-21002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">clewarecontrol</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">d</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;</span><span 
class="ecrm-0600">device</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ID</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">c</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">1</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">as</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">X</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">[1|0]</span>
   </div>
<!--l. 360--><p class="indent" >   where device ID is the ID of the cutter device, <span 
class="ectt-1095">X </span>is the index of power socket in the cutter
(zero-based), and the last number is 1 for switching the socket on, and 0 for switching it
off.
<!--l. 362--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.2   </span> <a 
 id="x1-220005.2"></a>USB-relays</h4>
<!--l. 363--><p class="noindent" >The Edison is controlled using a USB-relay in the +5V line on the USB-cable. The relay is
controlled using a Python script shipped with the AFT. The script sends binary data over serial to
switch the relay on and off.
<!--l. 365--><p class="indent" >   The USB-relays can be ordered from e.g. eBay. In some cases the switches are incorrectly
recognized by the testing harness. The serial controller identifies itself as something else but a
USB-to-serial adapter. The cause is probably incorrect internal firmware.
<!--l. 367--><p class="indent" >   This can be fixed by adding a custom USB device ID to the correct USB-to-serial driver. The
driver depends on the USB-to-serial chip used in the relay, common ones being <span 
class="ectt-1095">cp210x </span>and
<span 
class="ectt-1095">ftdi_sio</span>. Adding a new device can be done in a root terminal by using for example
<!--l. 368-->
<div class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-22001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">echo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">"0</span><span 
class="ecrm-0600">b00</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">3070"</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sys</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">bus</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">usb</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">serial</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">drivers</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">cp210x</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">new_id</span>
   </div>
<!--l. 371--><p class="indent" >   The device ID can be found with the help of e.g. <span 
class="ectt-1095">lsusb</span>. If the driver is not loaded, it can be
loaded manually using <span 
class="ectt-1095">modprobe</span>.
<!--l. 373--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-230006"></a>Gigabyte GB-BXBT-3825</h3>
<!--l. 376--><p class="noindent" >Gigabyte is an IoT-gateway platform. It has a Gigabit ethernet, two USB 2.0 ports and one USB 3.0
port, HDMI- and VGA-outputs and internal WLAN and Bluetooth cards. It comes with 2 GB of
ram and Intel Atom E3825 - the same one as in MinnowBoard MAX. It also has a 500 GB internal
hard drive, which is the boot device used for testing.
<!--l. 378--><p class="indent" >   The BIOS of Gigabyte has basic settings for boot option priorities and overriding the boot
priorities. It also has options to restart the device on AC power loss, which has to be set as the
                                                                                    

                                                                                    
booting is executed using a powercutter. Gigabyte supports Secure boot, but also has options for
disabling it and to let users add their own keys. To enter the BIOS press delete-key during
boot.
<!--l. 380--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>the BIOS only supports one boot media with legacy boot (MBR), which must be set as
the <span 
class="ectt-1095">Boot Option #1 </span>in <span 
class="ectt-1095">Boot =&#x003E; Hard Drive BBS Priorities</span>.
<!--l. 382--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>the USB 3.0 port in the front of the device doesn&#8217;t work as a boot device if used with a
USB 3.0 stick.
<!--l. 384--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>Gigabyte BIOS is notoriously buggy. It sometimes creates invisible options to the
boot override menu which replace a valid option but don&#8217;t work. To fix this, reflash the
BIOS.
<!--l. 386--><p class="indent" >   <span 
class="ecbx-1095">Note: </span>At the time of writing, Gigabyte requires a screen attached to the HDMI port in order to
boot in MBR mode. A screen in the VGA port does not work.
<!--l. 388--><p class="indent" >   Gigabyte supports only 12V DC input and requires a 2.5 A powersupply. The DC-plug has a
positive center.
<!--l. 390--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.1   </span> <a 
 id="x1-240006.1"></a>CI-integration</h4>
<!--l. 391--><p class="noindent" >Gigabyte is a PC-like device, similar to Galileo Gen 2 and MinnowBoard MAX. A Debian support
image is created on a USB-stick. It is recommended that the support image is created with a legacy
(non-EFI) bootloader. The BIOS settings are controlled with PEM-Arduino. The internal hard drive
is used for the target image.
<!--l. 393--><p class="indent" >   The internal ethernet adapter is used for networking.
<!--l. 395--><p class="indent" >   The PEM keyboard sequence should select the support image from <span 
class="ectt-1095">Save &amp; Exit =&#x003E; Boot</span>
<span 
class="ectt-1095">Override </span>menu. The image boot options should (automatically) be the top options in the boot
option priorities so the keyboard sequence for testing should be empty.
<!--l. 397--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                                    

                                                                                    
<a 
 id="x1-240012"></a>
                                                                                    

                                                                                    

<!--l. 399--><p class="noindent" ><img 
src="gigabytewiring.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2: </span><span  
class="content">Gigabyte GB-BXBT-3825 wiring diagram</span></div><!--tex4ht:label?: x1-240012 -->
                                                                                    

                                                                                    
<!--l. 402--><p class="indent" >   </div><hr class="endfigure">
   <h4 class="subsectionHead"><span class="titlemark">6.2   </span> <a 
 id="x1-250006.2"></a>Debian on Gigabyte</h4>
<!--l. 405--><p class="noindent" >These instructions are for creating a bootable Debian USB-stick for Gigabyte with MBR and
persistent storage.
<!--l. 408--><p class="indent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Make sure the internal hard drive doesn&#8217;t have a bootloader, or nuke the hard drive:
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Update the BIOS
     <!--l. 413-->
     <div class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-25003r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">if</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">zero</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">of</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sda</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bs</span><span 
class="ecrm-0600">=8</span><span 
class="ecrm-0600">M</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">count</span><span 
class="ecrm-0600">=500</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">In the BIOS disable Secure boot and set the
     <!--l. 419--><p class="noindent" ><span 
class="ectt-1095">Chipset =&#x003E; Restore AC Power Loss </span>to <span 
class="ectt-1095">Power On</span>.
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Dd a 64-bit Debian installation DVD to USB-stick:
     <!--l. 424-->
     <div class="lstlisting" id="listing-24"><span class="label"><a 
 id="x1-25006r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">if</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">debian</span><span 
class="ecrm-0600">-8.2.0-</span><span 
class="ecrm-0600">amd64</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">DVD</span><span 
class="ecrm-0600">-1.</span><span 
class="ecrm-0600">iso</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">of</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sdX</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bs</span><span 
class="ecrm-0600">=8</span><span 
class="ecrm-0600">M</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">sync</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Plug the USB-stick on a USB 2.0 port, boot the device and enter BIOS. <span 
class="ecbx-1095">Note: </span>if the
     USB-stick is a USB 3.0 stick, it will not boot from the USB 3.0 port!
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">Select the USB-stick as the primary legacy boot option in <span 
class="ectt-1095">Boot =&#x003E; Hard Drive BBS</span>
     <span 
class="ectt-1095">Priorities</span>. Select the USB-stick as the boot override option in <span 
class="ectt-1095">Save &amp; Exit =&#x003E; Boot</span>
     <span 
class="ectt-1095">Override</span>.
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">Only plug the target USB-stick after Debian installer menu is visible.
     </dd><dt class="enumerate-enumitem">
   8. </dt><dd 
class="enumerate-enumitem">Start Debian installation.
     </dd><dt class="enumerate-enumitem">
   9. </dt><dd 
class="enumerate-enumitem">When prompted for missing firmware files, don&#8217;t try to install them at this phase (answer
     &#8217;no&#8217;).
     </dd><dt class="enumerate-enumitem">
  10. </dt><dd 
class="enumerate-enumitem">Select hostname, use e.g. Debian-gigabyte.
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
  11. </dt><dd 
class="enumerate-enumitem">Root password: <span 
class="ectt-1095">rootme</span>
     </dd><dt class="enumerate-enumitem">
  12. </dt><dd 
class="enumerate-enumitem">User name: <span 
class="ectt-1095">user</span>, real name: <span 
class="ectt-1095">user</span>, password: <span 
class="ectt-1095">user</span>.
     </dd><dt class="enumerate-enumitem">
  13. </dt><dd 
class="enumerate-enumitem">For partitioning, automatical partition for entire disk with all files in one partition works.
     Remember to select the correct USB-drive.
     </dd><dt class="enumerate-enumitem">
  14. </dt><dd 
class="enumerate-enumitem">When prompted for software selection, the spacebar enables and disables options. Disable
     Debian desktop environment and print server, but enable SSH server. Enter to
     continue.
     </dd><dt class="enumerate-enumitem">
  15. </dt><dd 
class="enumerate-enumitem">Once the installation is finished, remove the installation media, set the remaining USB-stick as
     the primary legacy boot option and boot the newly installed Debian.
     </dd><dt class="enumerate-enumitem">
  16. </dt><dd 
class="enumerate-enumitem">Once booted, log in as <span 
class="ectt-1095">root</span>, plug in the test automation USB-stick and execute:
     <!--l. 452-->
     <div class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-25019r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sdc1</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">gigabyte</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">./</span><span 
class="ecrm-0600">installgigabyte</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">umount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">rm</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">r</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span>
     
     </div>
     <!--l. 456--><p class="noindent" >See the comments on the test automation USB-stick <span 
class="ectt-1095">gigabyte/installgigabyte </span>script for
     details of the post installation configuration.
     </dd><dt class="enumerate-enumitem">
  17. </dt><dd 
class="enumerate-enumitem">Reboot the device and from the BIOS menu, boot the Debian image.
     </dd><dt class="enumerate-enumitem">
  18. </dt><dd 
class="enumerate-enumitem">Manually flash the internal hard drive with a current testable image.
     </dd><dt class="enumerate-enumitem">
  19. </dt><dd 
class="enumerate-enumitem">Reboot the device, adjust the boot priorities so that the primary options are from the testable
     image.</dd></dl>
<!--l. 465--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-260007"></a>MinnowBoard MAX</h3>
<!--l. 468--><p class="noindent" >MinnowBoard MAX is an open development board with a 64-bit Intel Atom E3825 CPU (the same
as in Gigabyte) and 2 GB ram. It provides one microSD slot, a SATA2 connector, one of each USB
2.0 and USB 3.0 sockets, gigabit ethernet and a 6-pin serial output. It also has a microHDMI
connector for monitors.
<!--l. 470--><p class="indent" >   MinnowBoard MAX uses EFI for hardware initialization. The BIOS menu can be entered by
pressing <span 
class="ectt-1095">F2 </span>during boot. The boot priorities can be overridden in the <span 
class="ectt-1095">Boot Manager </span>menu, and the
priorities can be adjusted in <span 
class="ectt-1095">Boot Maintenance Manager</span>.
                                                                                    

                                                                                    
<!--l. 472--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.1   </span> <a 
 id="x1-270007.1"></a>CI-integration</h4>
<!--l. 474--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                    

                                                                                    
<a 
 id="x1-270013"></a>
                                                                                    

                                                                                    

<!--l. 476--><p class="noindent" ><img 
src="minnowwiring.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3: </span><span  
class="content">MinnowBoard MAX wiring diagram</span></div><!--tex4ht:label?: x1-270013 -->
                                                                                    

                                                                                    
<!--l. 479--><p class="noindent" ></div><hr class="endfigure">
<!--l. 481--><p class="indent" >   MinnowBoard MAX is a PC-like device, similar to Gigabyte and Galileo Gen 2. A Debian
support image is created on a USB-stick. For MinnowBoard MAX Debian, an EFI-enabled
bootloader is used but it has to be slightly modified for more convenient and stable test automation.
The instructions for this are at the end of section <a 
href="#x1-290007.3">7.3<!--tex4ht:ref: minnowdebian --></a>.
<!--l. 483--><p class="indent" >   The internal ethernet adapter is used for network connectivity.
<!--l. 485--><p class="indent" >   After the bootloader modification, the PEM keyboard sequence can be used to select <span 
class="ectt-1095">EFI USB</span>
<span 
class="ectt-1095">Device </span>as the boot device in the <span 
class="ectt-1095">Boot Manager </span>menu. The boot partitions of the image under test
should be set as the primary boot options in the <span 
class="ectt-1095">Boot Maintenance Manager </span>so that an empty
keyboard sequence can be used to boot it.
<!--l. 487--><p class="indent" >   The 6-pin serial output can be used for boot console recording at 115200 bauds.
<!--l. 489--><p class="indent" >   The microSD-card is used for the target image with MinnowBoard MAX.
   <h4 class="subsectionHead"><span class="titlemark">7.2   </span> <a 
 id="x1-280007.2"></a>Flashing the BIOS on MinnowBoard MAX</h4>
<!--l. 493--><p class="noindent" >MinnowBoard MAX supports both 32- and 64-bit firmwares. The official firmware site is
<a 
href="https://firmware.intel.com/projects/minnowboard-max" class="url" ><span 
class="ectt-1095">https://firmware.intel.com/projects/minnowboard-_max</span></a> but the firmware version <span 
class="ectt-1095">0.83 </span>has
been added to the testing automation USB-stick with both 32- and 64-bit flashing utilities. The
following instructions explain how to flash the firmware using the testing automation
USB-stick.
<!--l. 496--><p class="indent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Attach the testing automation USB-stick to MinnowBoard MAX along with a keyboard
     and a monitor.
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Reboot                    the                    device                    and                    enter
     the BIOS menu. Determine the architecture of current BIOS from the third line in the
     header. For example, <span 
class="ecti-1095">MNW2MAX1.</span><span 
class="ecbi-1095">X64</span><span 
class="ecti-1095">.0083.R01.1509181113</span>.
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Select  <span 
class="ectt-1095">EFI Internal Shell </span>as  the  boot  media.  (<span 
class="ectt-1095">Boot Manager =&#x003E; EFI Internal</span>
     <span 
class="ectt-1095">Shell</span>).
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Enter the USB-stick file system with the help of <span 
class="ectt-1095">Mapping Table</span>. In this example the
     USB-stick has been mapped to <span 
class="ectt-1095">FS0</span>. Note that the keyboard layout is US. <!--l. 503-->
     <div class="lstlisting" id="listing-26"><span class="label"><a 
 id="x1-28005r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">FS0</span><span 
class="ecrm-0600">:</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Change to the <span 
class="ectt-1095">minnowboardbios </span>folder: <!--l. 508-->
     <div class="lstlisting" id="listing-27"><span class="label"><a 
 id="x1-28007r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">minnowboardbios</span>
     
     </div>
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">Based on the BIOS version architecture, execute the correct updater; for X64 system
     <span 
class="ectt-1095">MinnowBoard.MAX.FirmwareUpdateX64.efi </span>and for IA32 systems the IA32 version.
     <!--l. 513-->
     <div class="lstlisting" id="listing-28"><span class="label"><a 
 id="x1-28009r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">MinnowBoard</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">MAX</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">FirmwareUpdateX64</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">efi</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">MinnowBoard</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">MAX</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">X64</span><span 
class="ecrm-0600">.083.</span><span 
class="ecrm-0600">R01</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">bin</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">The system will shut down after flashing is complete. You will have to reconfigure the BIOS
     settings after the update.</dd></dl>
<!--l. 520--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.3   </span> <a 
 id="x1-290007.3"></a>Debian on MinnowBoard MAX</h4>
<!--l. 523--><p class="noindent" >Because MinnowBoard MAX has only two USB-ports, and one of them is required for a keyboard, a
microSD-card must be used for installation media. The BIOS doesn&#8217;t support USB hubs but they
can be used after the OS is booted.
<!--l. 526--><p class="indent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Flash a 64-bit Debian installation image on a microSD-card:
     <!--l. 528-->
     <div class="lstlisting" id="listing-29"><span class="label"><a 
 id="x1-29002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">if</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">debian</span><span 
class="ecrm-0600">-8.2.0-</span><span 
class="ecrm-0600">amd64</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">DVD</span><span 
class="ecrm-0600">-1.</span><span 
class="ecrm-0600">iso</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">of</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sdX</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bs</span><span 
class="ecrm-0600">=8</span><span 
class="ecrm-0600">M</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">sync</span>
     
     </div>
     <!--l. 531--><p class="noindent" >Select <span 
class="ectt-1095">X </span>to match the SD-card device on your machine with the help of e.g. <span 
class="ectt-1095">lsblk</span>.
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Using e.g. <span 
class="ectt-1095">gparted </span>remove the default partitioning of the target USB-stick.
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Insert the SD-card to a MinnowBoard MAX. Do <span 
class="ecti-1095">not </span>insert the USB stick yet!. Reboot the
     device and from BIOS menu select the Misc device to boot from the SD-card. A Debian
     installer menu should appear.
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Insert the target USB-stick.
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Start installation, select language (English), locale (Irish) and keyboard layout
     (Finnish).
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">When prompted for CD-ROM drivers, select <span 
class="ectt-1095">No</span>. Then manually select the CD-ROM module
     and device (<span 
class="ectt-1095">yes</span>), select the module needed for access the CD-ROM (<span 
class="ectt-1095">none</span>) and device file for
     accessing the CD-ROM: <span 
class="ectt-1095">/dev/mmcblk0</span>.
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">When prompted for missing firmware files, don&#8217;t try to install them at this point (answer:
     No).
     </dd><dt class="enumerate-enumitem">
   8. </dt><dd 
class="enumerate-enumitem">Select hostname, use e.g. Debian-MinnowMAX, and leave the network name empty.
     </dd><dt class="enumerate-enumitem">
   9. </dt><dd 
class="enumerate-enumitem">Set the root password, use <span 
class="ectt-1095">rootme</span>
     </dd><dt class="enumerate-enumitem">
  10. </dt><dd 
class="enumerate-enumitem">Create a user, use user name: <span 
class="ectt-1095">user</span>, real name: <span 
class="ectt-1095">user </span>and password <span 
class="ectt-1095">user</span>.
     </dd><dt class="enumerate-enumitem">
  11. </dt><dd 
class="enumerate-enumitem">Adding a network package source is not necessary, it is added by a post-install
     script.
     </dd><dt class="enumerate-enumitem">
  12. </dt><dd 
class="enumerate-enumitem">When prompted for software selection, the spacebar enables and disables options. Disable
     Debian desktop environment and print server, but enable SSH server. Enter to
     continue.
     </dd><dt class="enumerate-enumitem">
  13. </dt><dd 
class="enumerate-enumitem">After the installation is finished, eject the microSD-card, select <span 
class="ectt-1095">debian </span>as the boot device in
     the BIOS <span 
class="ectt-1095">Boot Manager </span>and login to the Debian.
     </dd><dt class="enumerate-enumitem">
  14. </dt><dd 
class="enumerate-enumitem">Format the microSD-card and from the testing automation USB-stick, copy the contents of the
     contents of <span 
class="ectt-1095">minnowboard </span>folder to the card.
     </dd><dt class="enumerate-enumitem">
  15. </dt><dd 
class="enumerate-enumitem">Plug the SD-card in the MinnowBoard MAX, execute the following: <!--l. 560-->
     <div class="lstlisting" id="listing-30"><span class="label"><a 
 id="x1-29017r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">mmcblk0p1</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">templs</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">chmod</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">+</span><span 
class="ecrm-0600">x</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">installminnow</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">./</span><span 
class="ecrm-0600">installminnow</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cd</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">umount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">mmcblk0p1</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">rm</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">r</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">temp</span>
     
     </div>
     <!--l. 564--><p class="noindent" >See the comments on the test automation USB-stick <span 
class="ectt-1095">minnowboard/installminnow </span>script for
     details of the post installation configuration.
     </dd><dt class="enumerate-enumitem">
  16. </dt><dd 
class="enumerate-enumitem">Reboot the device using <span 
class="ectt-1095">reboot </span>and from BIOS menu select the EFI USB Device as the boot
     device.
     </dd><dt class="enumerate-enumitem">
  17. </dt><dd 
class="enumerate-enumitem">manually flash the microSD-card with a current testable image.
     </dd><dt class="enumerate-enumitem">
  18. </dt><dd 
class="enumerate-enumitem">Reboot the device and enter BIOS menu.
     </dd><dt class="enumerate-enumitem">
  19. </dt><dd 
class="enumerate-enumitem">In <span 
class="ectt-1095">Boot Maintenance Manager </span>delete the <span 
class="ectt-1095">debian </span>boot entry. Then adjust the boot option
     order so that the previously flashed image is the primary boot device.</dd></dl>
                                                                                    

                                                                                    
<!--l. 575--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-300008"></a>Galileo Gen 2</h3>
<!--l. 578--><p class="noindent" >Galileo Gen 2 is a Quark development board with 256 MB of ram. It has integrated 100 ethernet
connectivity, a microSD slot, a USB 2.0-port and a 6-pin serial connection socket. Underneath
the board there is a full-size Mini PCIE card slot. Therefore if a half-size Mini PCIE
card (e.g. Intel Wireless N 7260) is used in testing, a half- to full-size adapter has to be
used.
<!--l. 580--><p class="indent" >   Galileo Gen 2 supports input voltage between 7V and 15V. The included power supply is 12V,
1.25A. The DC-plug has a positive center.
<!--l. 582--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-310008.1"></a>BIOS</h4>
<!--l. 583--><p class="noindent" >The BIOS menu of Galileo Gen 2 is very limited. It only provides an option to select a boot-device
by pressing <span 
class="ectt-1095">F7 </span>during boot time. The relevant options from CI-perspective are the microSD-card,
represented as "Misc device" in the boot menu, and the USB-stick, represented with the make and
model of the stick in the boot menu. Other options include e.g. EFI-shell and the yocto-image
flashed to the internal storage.
<!--l. 585--><p class="indent" >   The primary boot option is the "first misc or USB-device", which is not specified further. The
first boot option depends on the order in which the microSD-card and the USB-stick have been
inserted. If the test cases include a test which reboots the device, the testable image has to be put
in the primary boot option, and the support image has to be on the secondary boot
device.
<!--l. 587--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-320008.2"></a>CI-integration</h4>
<!--l. 589--><p class="noindent" >In CI-system Galileo Gen 2 is a "PC-like" device, and therefore similar to Gigabyte and
MinnowBoard MAX. To integrate Galileo Gen 2 in automated testing, the USB-socket has to be
extended using a USB-hub, to connect both a PEM-Arduino and a USB-stick with bootable support
image. The microSD-card is used for the target image.
<!--l. 591--><p class="indent" >   The integrated ethernet adapter is used for network connectivity.
<!--l. 593--><p class="indent" >   The 6-pin serial output can be used for boot console recording at 115200 bauds.
<!--l. 595--><p class="indent" >   The PEM keyboard sequence to boot the support image should be the selection of secondary
boot device, while the sequence to boot the testable image should be empty.
<!--l. 597--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                                    

                                                                                    
<a 
 id="x1-320014"></a>
                                                                                    

                                                                                    

<!--l. 599--><p class="noindent" ><img 
src="galileogen2wiring.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;4: </span><span  
class="content">Galileo Gen 2 wiring diagram</span></div><!--tex4ht:label?: x1-320014 -->
                                                                                    

                                                                                    
<!--l. 602--><p class="indent" >   </div><hr class="endfigure">
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-330008.3"></a>Debian on Galileo Gen 2</h4>
<!--l. 606--><p class="noindent" >The following instructions are based on the preliminary work by Igor Stoppa in creating a bootable
SD-card Debian image with persistent storage for the first generation Galileo. Several modifications
and additions had to be made to his instructions but the basic idea has remained the same. The
main difficulty is finding a Linux distribution which is bootable with an i586 device, as almost all
"32-bit" distributions are using at least i686 architecture. Additionally, the kernel configuration
required for Galileo Gen 2 had to be searched experimentally, to get all the features required for
AFT-integration. The end result is an image which can be booted from both an SD-card or a
USB-stick.
<!--l. 608--><p class="indent" >   The high-level workflow is as follows:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Prepare a 32-bit Debian Virtualbox virtual machine
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Build a custom Linux kernel using BSP provided by Intel
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Using debootstrap, prepare the base OS
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Add other required programs and configuration to the image.
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Manually construct the boot partition using the custom kernel and EFI GRUB from a
     Galileo Gen2 image provided by Intel.</dd></dl>
<!--l. 618--><p class="indent" >   The instructions have been tested on 18.11.2015 using a Fedora 22 host machine, 32-bit Debian
8.2 and VirtualBox 5.0.10.
<!--l. 620--><p class="indent" >   In the following subsections the instructions are described in more detailed manner.
<!--l. 622--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-340008.3"></a>Virtualmachine creation</h5>
<!--l. 624--><p class="noindent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Using VirtualBox, create a new Debian (32 bit) virtualmachine with 2 GB RAM and
     50 GB dynamically allocated VDI harddrive. <span 
class="ecbx-1095">Note: </span>You have to enable a NAT network
     adapter in the VM settings to have an internet connection inside the VM guest.
     <!--l. 626--><p class="noindent" >It is recommended to enable also bidirectional shared clipboard and drag&#8217;n&#8217;drop support.
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Add a 32-bit Debian installation media in the virtual CD-drive of the VM, start the VM
     and install it following the installer instructions.
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Remove the installation media from the virtual CD-drive and restart the VM.
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Once booted, start a terminal and <span 
class="ectt-1095">su </span>to root terminal. <span 
class="ecbx-1095">Note: </span>If you are behind a proxy,
     it is recommended to set the settings at this point in <span 
class="ectt-1095">.bashrc</span>.
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Comment out CD/DVD-entries in <!--l. 635-->
     <div class="lstlisting" id="listing-31"><span class="label"><a 
 id="x1-34006r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">vi</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">etc</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">apt</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sources</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">list</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">Install required packages to the Debian system: <!--l. 640-->
     <div class="lstlisting" id="listing-32"><span class="label"><a 
 id="x1-34008r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">apt</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">get</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">install</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">debootstrap</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">vim</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">build</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">essential</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">binutils</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gawk</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">chrpath</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">kernel</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">package</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">fakeroot</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">libncurses5</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gparted</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dkms</span>
     
     </div>
     <!--l. 644--><p class="noindent" >When prompted about the version of kernel config, it is recommended to use the package
     maintainer&#8217;s.
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">Install VirtualBox guest additions to the guest and the host systems using instructions from
     <a 
href="https://www.virtualbox.org/manual/ch04.html" >VirtualBox manual</a>.
     </dd><dt class="enumerate-enumitem">
   8. </dt><dd 
class="enumerate-enumitem">Create a shared folder between the host and the VM. In these instructions the
     folder is named <span 
class="ectt-1095">shared </span>on both the host, and the guest machine, under the root
     home.
     </dd><dt class="enumerate-enumitem">
   9. </dt><dd 
class="enumerate-enumitem">Download and unpack the SDCard tarball from
     <a 
href="https://downloadcenter.intel.com/download/24355/Intel-Arduino-IDE-1-6-0" class="url" ><span 
class="ectt-1095">https://downloadcenter.intel.com/download/24355/Intel-_Arduino-_IDE-_1-_6-_0</span></a> . At
     the time of writing, the file was named <span 
class="ectt-1095">SDCard.1.0.4.tar.bz2</span>
     </dd><dt class="enumerate-enumitem">
  10. </dt><dd 
class="enumerate-enumitem">copy the extracted <span 
class="ectt-1095">image-full-galileo</span>-folder to the shared folder. The folder should contain
     at least <span 
class="ectt-1095">grub.efi</span>, and <span 
class="ectt-1095">boot/grub/grub.conf</span>.</dd></dl>
<!--l. 655--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-350008.3"></a>Kernel construction</h5>
<!--l. 657--><p class="noindent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Enter the virtualmachine, start a terminal and switch to root shell using <span 
class="ectt-1095">su</span>
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Download    Intel    Quark    Board    Support    Package    (BSP)    sources    from
     <a 
href="https://downloadcenter.intel.com/download/23197/Intel-Quark-BSP" class="url" ><span 
class="ectt-1095">https://downloadcenter.intel.com/download/23197/Intel-_Quark-_BSP</span></a> using eg.
     <span 
class="ectt-1095">wget </span>.
     <!--l. 661--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>At the time of writing the latest version (v. 1.20) had a non-existing base commit
     ID. Therefore an older version (eg. 1.10) must be used.
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Unpack the BSP using <!--l. 664-->
     <div class="lstlisting" id="listing-33"><span class="label"><a 
 id="x1-35004r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">7</span><span 
class="ecrm-0600">za</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">e</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">.7</span><span 
class="ecrm-0600">z</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">tar</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">xvf</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">quark_linux_</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">tar</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">gz</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">C</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bsp</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Git clone the latest stable kernel repository
     <!--l. 670--><p class="noindent" ><span 
class="ectt-1095">git clone https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git</span>
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Checkout the commit SHA found inside <span 
class="ectt-1095">&#x003C;bsp&#x003E;/quark_linux_v3.8.7+v1.1.0/upstream.cfg</span>
     <!--l. 673-->
     <div class="lstlisting" id="listing-34"><span class="label"><a 
 id="x1-35007r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">checkout</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">531</span><span 
class="ecrm-0600">ec28f9f26f78797124b9efcf2138b8974a1e</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">Apply the patches required for Galileo Gen2: <!--l. 678-->
     <div class="lstlisting" id="listing-35"><span class="label"><a 
 id="x1-35009r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">am</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">../</span><span 
class="ecrm-0600">bsp</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">quark_linux_v3</span><span 
class="ecrm-0600">.8.7+</span><span 
class="ecrm-0600">v1</span><span 
class="ecrm-0600">.1.0/</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">patch</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">Copy the provided kernel config from the stick <span 
class="ectt-1095">Galileov2/.config </span>to the kernel repository
     root.
     </dd><dt class="enumerate-enumitem">
   8. </dt><dd 
class="enumerate-enumitem">If you wish to customize the kernel configuration, use <span 
class="ectt-1095">make menuconfig</span>. For example, adding
     all the USB-drivers may be desirable.
     </dd><dt class="enumerate-enumitem">
   9. </dt><dd 
class="enumerate-enumitem">Compile kernel: <!--l. 687-->
     <div class="lstlisting" id="listing-36"><span class="label"><a 
 id="x1-35013r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">fakeroot</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">make</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">kpkg</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">initrd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">kernel_image</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">modules_image</span><span 
class="ecrm-0600">}</span>
     
     </div>
     <!--l. 690--><p class="noindent" >The .deb package should appear on one folder <span 
class="ecti-1095">above </span>your working directory.</dd></dl>
<!--l. 693--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-360008.3"></a>Debian base construction</h5>
<!--l. 695--><p class="noindent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Create the empty image file and start partitioning <!--l. 696-->
     <div class="lstlisting" id="listing-37"><span class="label"><a 
 id="x1-36002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">of</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">galileoimage</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">img</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bs</span><span 
class="ecrm-0600">=1</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">count</span><span 
class="ecrm-0600">=0</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">seek</span><span 
class="ecrm-0600">=2</span><span 
class="ecrm-0600">G</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">losetup</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">f</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">galileoimage</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">img</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gparted</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">loop0</span>
     
     </div>
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Using gparted, first add a partition table (msdos is fine) and then add 3 partitions: fat32
     100MB, linux-swap 500MB, and ext4 the rest. Finally, add <span 
class="ectt-1095">boot </span>and <span 
class="ectt-1095">esp </span>flags to the fat32
     partition.
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Mount the partitions <!--l. 703-->
     <div class="lstlisting" id="listing-38"><span class="label"><a 
 id="x1-36005r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_boot</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">loop0p1</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_boot</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">loop0p3</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Prepare the base system using debootstrap: <!--l. 708-->
     <div class="lstlisting" id="listing-39"><span class="label"><a 
 id="x1-36007r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">debootstrap</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">arch</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">i386</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">stable</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">http</span><span 
class="ecrm-0600">://</span><span 
class="ecrm-0600">http</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">debian</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">net</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">debian</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Rest of the preparation of the chroot environment: <!--l. 713-->
     <div class="lstlisting" id="listing-40"><span class="label"><a 
 id="x1-36009r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">mount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">bind</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">--</span><span 
class="ecrm-0600">bind</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">pts</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">pts</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">linux</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">image</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">deb</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/</span>
     
     </div>
     </dd></dl>
<!--l. 718--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-370008.3"></a>Image configuration</h5>
<!--l. 720--><p class="noindent" >
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">In root shell home, copy the <span 
class="ectt-1095">authorized_keys</span>-file from the usb-stick to the chroot root home:
     <!--l. 721-->
     <div class="lstlisting" id="listing-41"><span class="label"><a 
 id="x1-37002r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003C;</span><span 
class="ecrm-0600">authorized_keys</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">authorized_keys</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Start the chroot environment: <!--l. 726-->
     <div class="lstlisting" id="listing-42"><span class="label"><a 
 id="x1-37004r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">chroot</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Install packages required for maintenance: <!--l. 731-->
     <div class="lstlisting" id="listing-43"><span class="label"><a 
 id="x1-37006r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">apt</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">get</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">install</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">locales</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ntp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">openssh</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">server</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">vim</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">initramfs</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">tools</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">net</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">tools</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bash</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">completion</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">python</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">pip</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nfs</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">common</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nfs</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">server</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nano</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">git</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bmap</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">tools</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">parted</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">attr</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">gdisk</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">tree</span>
     
     </div>
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Add the serial terminal: <!--l. 736-->
     <div class="lstlisting" id="listing-44"><span class="label"><a 
 id="x1-37008r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">echo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">t0</span><span 
class="ecrm-0600">:2345:</span><span 
class="ecrm-0600">respawn</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sbin</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">getty</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">L</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">115200</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ttyS1</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">vt102</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">etc</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">inittab</span>
     
     </div>
     <!--l. 740--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>: The terminal interface (<span 
class="ectt-1095">ttyS1</span>) depends on the BSP version. This has been tested for
     1.10 but an earlier version may use <span 
class="ectt-1095">ttyQRK1</span>.
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Set the password for root user: <span 
class="ectt-1095">passwd</span>
     <!--l. 744--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>: The root password in support images so far has been <span 
class="ectt-1095">rootme</span>
     </dd><dt class="enumerate-enumitem">
   6. </dt><dd 
class="enumerate-enumitem">Set the hostname <!--l. 747-->
     <div class="lstlisting" id="listing-45"><span class="label"><a 
 id="x1-37011r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">echo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">Debian</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">Galileov2</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">etc</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">hostname</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   7. </dt><dd 
class="enumerate-enumitem">Add the hostname to name resolution in <span 
class="ectt-1095">etc/hosts</span>: <!--l. 752-->
     <div class="lstlisting" id="listing-46"><span class="label"><a 
 id="x1-37013r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">127.0.0.1</span><span 
class="ecrm-0600">localhost</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">Debian</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">Galileov2</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-37014r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">::1</span><span 
class="ecrm-0600">localhost</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ip6</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">localhost</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ip6</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">loopback</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">Debian</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">Galileov2</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
   8. </dt><dd 
class="enumerate-enumitem">Configure network interface(s) <span 
class="ectt-1095">vim /etc/network/interfaces</span>: <!--l. 758-->
     <div class="lstlisting" id="listing-47"><span class="label"><a 
 id="x1-37016r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">auto</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">eth0</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-37017r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">iface</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">eth0</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">inet</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dhcp</span>
     
     </div>
     <!--l. 762--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>It is a good idea to add multiple network interfaces (<span 
class="ectt-1095">eth1, eth2, ...</span>) if you want to
     use the same stick in multiple devices.
     </dd><dt class="enumerate-enumitem">
   9. </dt><dd 
class="enumerate-enumitem">Permit root login over ssh: <!--l. 765-->
     <div class="lstlisting" id="listing-48"><span class="label"><a 
 id="x1-37019r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">echo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">PermitRootLogin</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">yes</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x003E;&#x003E;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">etc</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">ssh</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sshd_config</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  10. </dt><dd 
class="enumerate-enumitem">Add ssh-key: <!--l. 770-->
     <div class="lstlisting" id="listing-49"><span class="label"><a 
 id="x1-37021r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">p</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/.</span><span 
class="ecrm-0600">ssh</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">chmod</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">700</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/.</span><span 
class="ecrm-0600">ssh</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mv</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">authorized_keys</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/.</span><span 
class="ecrm-0600">ssh</span><span 
class="ecrm-0600">/;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">chmod</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">600</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/.</span><span 
class="ecrm-0600">ssh</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">authorized_keys</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  11. </dt><dd 
class="enumerate-enumitem">Create NFS and testable image mount point directories: <!--l. 775-->
     <div class="lstlisting" id="listing-50"><span class="label"><a 
 id="x1-37023r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">mnt</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">img_data_nfs</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">mnt</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">super_target_root</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">mnt</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">target_root</span>
     
                                                                                    

                                                                                    
     </div>
     </dd><dt class="enumerate-enumitem">
  12. </dt><dd 
class="enumerate-enumitem">Add entries to <span 
class="ectt-1095">/etc/fstab</span>: <span 
class="ectt-1095">vim /etc/fstab</span>: <!--l. 780-->
     <div class="lstlisting" id="listing-51"><span class="label"><a 
 id="x1-37025r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sda3</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">ext4</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">defaults</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">0</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">0</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-37026r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">192.168.30.1:/</span><span 
class="ecrm-0600">home</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">tester</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">mnt</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">img_data_nfs</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">nfs</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">rsize</span><span 
class="ecrm-0600">=8192,</span><span 
class="ecrm-0600">wsize</span><span 
class="ecrm-0600">=8192,</span><span 
class="ecrm-0600">timeo</span><span 
class="ecrm-0600">=14,</span><span 
class="ecrm-0600">intr</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">nolock</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">auto</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  13. </dt><dd 
class="enumerate-enumitem">Install the kernel package: <!--l. 786-->
     <div class="lstlisting" id="listing-52"><span class="label"><a 
 id="x1-37028r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">dpkg</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">i</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">/</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">deb</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  14. </dt><dd 
class="enumerate-enumitem">Fix <a 
href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=738575" class="url" ><span 
class="ectt-1095">https://bugs.debian.org/cgi-_bin/bugreport.cgi?bug=738575</span></a>. The command
     replaces every <span 
class="ectt-1095">lock </span>instruction with a <span 
class="ectt-1095">nop</span>. This works because Quark is a single-core
     processor: <!--l. 791-->
     <div class="lstlisting" id="listing-53"><span class="label"><a 
 id="x1-37030r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">for</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">i</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">in</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#8216;/</span><span 
class="ecrm-0600">usr</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">bin</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">find</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">lib</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">type</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">f</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">name</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">pthread</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">so</span><span 
class="ecrm-0600">&#8216;;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">do</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">$</span><span 
class="ecrm-0600">\{</span><span 
class="ecrm-0600">i</span><span 
class="ecrm-0600">\}</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">$</span><span 
class="ecrm-0600">\{</span><span 
class="ecrm-0600">i</span><span 
class="ecrm-0600">\}.</span><span 
class="ecrm-0600">bak</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">sed</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">i</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">s</span><span 
class="ecrm-0600">/\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">xf0</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">x0f</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">xb1</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">x8b</span><span 
class="ecrm-0600">/\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">x90</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">x0f</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">xb1</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">bl</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">x8b</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">g</span><span 
class="ecrm-0600">"</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">$</span><span 
class="ecrm-0600">\{</span><span 
class="ecrm-0600">i</span><span 
class="ecrm-0600">\};</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">done</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  15. </dt><dd 
class="enumerate-enumitem">Leave the chroot environment using <span 
class="ectt-1095">ctrl+d</span>
     </dd><dt class="enumerate-enumitem">
  16. </dt><dd 
class="enumerate-enumitem">Copy the EFI files from shared folder: <!--l. 798-->
     <div class="lstlisting" id="listing-54"><span class="label"><a 
 id="x1-37033r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">mkdir</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">p</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_boot</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">EFI</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">BOOT</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">linebreak</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">shared</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">image</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">full</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">galileo</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">grub</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">efi</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_boot</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">EFI</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">BOOT</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">bootia32</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">efi</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">\</span><span 
class="ecrm-0600">linebreak</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">a</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">shared</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">image</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">full</span><span 
class="ecrm-0600">-</span><span 
class="ecrm-0600">galileo</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">boot</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_boot</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  17. </dt><dd 
class="enumerate-enumitem">Copy the kernel files to boot partition: <!--l. 803-->
     <div class="lstlisting" id="listing-55"><span class="label"><a 
 id="x1-37035r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_root</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">boot</span><span 
class="ecrm-0600">/</span><span 
class="cmsy-6">*</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">usb_boot</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  18. </dt><dd 
class="enumerate-enumitem">Modify the <span 
class="ectt-1095">usb_boot/boot/grub/grub.conf</span>, make the following entry and remove the others:
     <!--l. 808-->
     <div class="lstlisting" id="listing-56"><span class="label"><a 
 id="x1-37037r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">title</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">Debian</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-37038r2"></a><span 
class="ecrm-0600">2</span></span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">(</span><span 
class="ecrm-0600">hd0</span><span 
class="ecrm-0600">,0)</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-37039r3"></a><span 
class="ecrm-0600">3</span></span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">kernel</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">vmlinuz</span><span 
class="ecrm-0600">-3.8.7+</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">root</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sda3</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">3</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">console</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">ttyS1</span><span 
class="ecrm-0600">,115200</span><span 
class="ecrm-0600">n8</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">earlycon</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">uart8250</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">mmio32</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">$EARLY_CON_ADDR_REPLACE</span><span 
class="ecrm-0600">,115200</span><span 
class="ecrm-0600">n8</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">vmalloc</span><span 
class="ecrm-0600">=3844</span><span 
class="ecrm-0600">M</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">reboot</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">efi</span><span 
class="ecrm-0600">,</span><span 
class="ecrm-0600">warm</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">apic</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">debug</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">rw</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">LABEL</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">boot</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">debugshell</span><span 
class="ecrm-0600">=5</span><span 
class="ecrm-0600">&#x00A0;</span><br /><span class="label"><a 
 id="x1-37040r4"></a><span 
class="ecrm-0600">4</span></span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">initrd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">initrd</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">img</span><span 
class="ecrm-0600">-3.8.7+</span>
     
     </div>
     <!--l. 814--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>You may have to modify the <span 
class="ectt-1095">vmlinuz-3.8.7+ </span>and <span 
class="ectt-1095">initrd.img-3.8.7 </span>to correspond
     your kernel and initrd files.
     <!--l. 816--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>If you want to boot the image from a SD-card, modify the <span 
class="ectt-1095">root=/dev/sda3 </span>option to
     point to the SD-card: <span 
class="ectt-1095">root=/dev/mmcblk0p3</span>.
                                                                                    

                                                                                    
     </dd><dt class="enumerate-enumitem">
  19. </dt><dd 
class="enumerate-enumitem">Unmount everything and copy the image to the shared folder. <!--l. 819-->
     <div class="lstlisting" id="listing-57"><span class="label"><a 
 id="x1-37042r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">umount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">loop0p1</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">umount</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">loop0p3</span><span 
class="ecrm-0600">;</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">cp</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">galileoimage</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">img</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">shared</span>
     
     </div>
     </dd><dt class="enumerate-enumitem">
  20. </dt><dd 
class="enumerate-enumitem">Poweroff the VM.
     </dd><dt class="enumerate-enumitem">
  21. </dt><dd 
class="enumerate-enumitem">Inside the host system, dd the <span 
class="ectt-1095">galileoimage.img </span>to a USB-stick: <!--l. 826-->
     <div class="lstlisting" id="listing-58"><span class="label"><a 
 id="x1-37045r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">sudo</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">dd</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">if</span><span 
class="ecrm-0600">=</span><span 
class="ecrm-0600">shared</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">galileoimage</span><span 
class="ecrm-0600">.</span><span 
class="ecrm-0600">img</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">of</span><span 
class="ecrm-0600">=/</span><span 
class="ecrm-0600">dev</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">sdX</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">bs</span><span 
class="ecrm-0600">=8</span><span 
class="ecrm-0600">M</span>
     
     </div>
     <!--l. 830--><p class="noindent" ><span 
class="ecbx-1095">Note: </span>modify the X to correspond your USB-stick device which can be found using eg.
     <span 
class="ectt-1095">lsblk</span>.</dd></dl>
<!--l. 833--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">9   </span> <a 
 id="x1-380009"></a>Intel Edison</h3>
<!--l. 836--><p class="noindent" >Intel Edison is a development platform intended for wearable devices. It is a SoC with
two Intel Atom cores and one Intel Quark core, GB of internal RAM and integrated
Bluetooth and Wi-Fi. The Atoms are normal x64 cores while the Quark is roughly an i586
processor.
<!--l. 838--><p class="indent" >   Edison can be mounted on an Arduino development kit which provides Arduino UNO compatible
pin layout. The development board also has a USB-serial interface, a mechanical switch to select
between a micro-USB device controller and a normal USB socket, a DC plug and a microSD
socket.
<!--l. 840--><p class="indent" >   Edison uses a hacked U-Boot for hardware initialization.
<!--l. 842--><p class="indent" >   From flashing perspective, Edison is closer to a mobile phone or similar "gadget" device than a
complete PC. The OS image is written using DFU.
<!--l. 844--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.1   </span> <a 
 id="x1-390009.1"></a>USB-interfaces</h4>
<!--l. 846--><p class="noindent" >When an Edison is plugged to a computer, it is first detected as an Intel Merrifield device
(<span 
class="ectt-1095">8086:e005</span>), which is used to recover the DFU-utility in the firmware. After a few seconds the
device disconnects and reconnects as DFU-device, Intel USB download gadget (<span 
class="ectt-1095">8087:0a99</span>). At this
stage the OS can be flashed. If DFU-communication is not initialized in a couple of seconds, the
device disconnects again and finally boots normally.
<!--l. 848--><p class="indent" >   After the boot process, the device is detected with multiple interfaces with ID <span 
class="ectt-1095">8087:0a9e</span>. It can
be used as a USB-storage, USB-serial device (at <span 
class="ectt-1095">/dev/ttyACM</span><span 
class="ecit-1095">X </span>) and as a USB-network
interface.
<!--l. 850--><p class="indent" >   The USB-network interface is used for network connectivity. This interface has to be configured
on both the image under test and the testing harness. Network configuration is handled by AFT
<a 
href="#x1-140003">3<!--tex4ht:ref: aft --></a>.
                                                                                    

                                                                                    
<!--l. 852--><p class="indent" >   The USB-network interface of the Edison gets a random MAC-address every time the image is
flashed. This also causes the network interface on the testing harness being recreated and
renamed.
<!--l. 854--><p class="indent" >   If there are multiple Edisons attached to the testing harness, the only way to differentiate
between them is the USB-tree or USB-paths. Using the paths, each physical USB-port can be
differentiated from each other.
<!--l. 856--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">9.2   </span> <a 
 id="x1-400009.2"></a>CI-integration</h4>
<!--l. 858--><p class="noindent" >Integrating Edisons to the testing automation requires a way to power off and on the device
programmatically.
<!--l. 860--><p class="indent" >   The best solution would be to find USB-hubs that supports Linux kernel&#8217;s USB power options at
<span 
class="ectt-1095">/sys/bus/usb/devices/usb1/power/ </span>on per-port accuracy. Unfortunately this kind of USB-hubs
are extremely difficult to find.
<!--l. 862--><p class="indent" >   An implemented alternative is to use a power cutter on USB-cable&#8217;s +5V line. Because the
device is powered by USB, the power cutter also shuts down the device. This requires exposing the
+5V cable, stripping it, and attaching the newly open ends to a USB-controlled relay, as instructed
in figure <a 
href="#x1-400015">5<!--tex4ht:ref: fig:usbpower --></a>.
<!--l. 864--><p class="indent" >   The USB-serial interface can be used for boot console recording at 115200 bauds.
<hr class="figure"><div class="figure" 
>
                                                                                    

                                                                                    
<a 
 id="x1-400015"></a>
                                                                                    

                                                                                    
<div class="minipage"><!--l. 869--><p class="noindent" ><img 
src="edisonwire1.jpg" alt="PIC"  
>
<!--l. 871--><p class="noindent" >1. Expose the wire shielding by cutting a 5
cm slice through the jacket, about 7 cm from
the USB-A plug.
</div> <div class="minipage"><img 
src="edisonwire2.jpg" alt="PIC"  
>
<!--l. 877--><p class="noindent" >2. Strip the shielding carefully. Expose the
red wire (+5V) and cut it in half.
                                                                                    

                                                                                    
</div> <div class="minipage"><img 
src="edisonwire3.jpg" alt="PIC"  
>
<!--l. 884--><p class="noindent" >3. Strip the wire, solder small beads of tin on
the tips. Cover the cut with electrical tape.
</div> <div class="minipage"><img 
src="edisonwire4.jpg" alt="PIC"  
>
<!--l. 891--><p class="noindent" >4. Final setup.
                                                                                    

                                                                                    
</div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5: </span><span  
class="content">USB-power cutter cable.</span></div><!--tex4ht:label?: x1-400015 -->
                                                                                    

                                                                                    
<!--l. 895--><p class="indent" >   </div><hr class="endfigure">
<!--l. 897--><p class="indent" >
                                                                                    

                                                                                    
   <h3 class="sectionHead"><span class="titlemark">A   </span> <a 
 id="x1-41000A"></a>AFT implementation details</h3>
<!--l. 902--><p class="noindent" >In this appendix, configuration options are detailed. Also, a high level description of most important
AFT implementation decisions are explained.
<!--l. 904--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">A.1   </span> <a 
 id="x1-42000A.1"></a>Configuration</h4>
<!--l. 906--><p class="noindent" >All AFT configuration is done with configuration files stored in <span 
class="ectt-1095">/etc/aft</span>.
<!--l. 908--><p class="indent" >   Configuration files for the testable devices are stored in the subfolder <span 
class="ectt-1095">devices</span>. The configuration
of a single physical device is combined out of these files.
<!--l. 910--><p class="indent" >   In the <span 
class="ectt-1095">test_plan </span>folder is the configuration for each AFT test-plan.
<!--l. 912--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-43000A.1"></a>devices/platform.cfg</h5>
<!--l. 913--><p class="noindent" >The <span 
class="ectt-1095">platform.cfg </span>is the highest level configuration file. It is intended to store settings which are
shared between all high-level device-types, ie. PC-devices or gadget-devices.
<!--l. 915--><p class="indent" >   This is also the place where settings for automatic construction of the device topology can be
stored. For example the <span 
class="ectt-1095">leases_file_name </span>refers to the location of the leases file used by <span 
class="ectt-1095">dnsmasq</span>.
This file can be used to detect devices attached to the local network in which the PC-devices are
kept in.
<!--l. 917--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-44000A.1"></a>devices/catalog.cfg</h5>
<!--l. 918--><p class="noindent" >The <span 
class="ectt-1095">catalog.cfg </span>is the configuration file describing each device type. These are the options shared
by all devices of the same type.
<!--l. 920--><p class="indent" >   Each section in <span 
class="ectt-1095">catalog.cfg </span>must include at least the <span 
class="ectt-1095">platform</span>, <span 
class="ectt-1095">cutter_type </span>and <span 
class="ectt-1095">test_plan</span>
options.
<!--l. 922--><p class="indent" >   The <span 
class="ectt-1095">platform </span>option is used to load the correct high-level device configuration from the
<span 
class="ectt-1095">platform.cfg </span>file.
<!--l. 924--><p class="indent" >   The <span 
class="ectt-1095">cutter_type </span>is used to determine the type of cutter used for the devices. At the time of
writing the options are <span 
class="ectt-1095">clewarecutter </span>and <span 
class="ectt-1095">usbrelay</span>.
<!--l. 926--><p class="indent" >   The <span 
class="ectt-1095">test_plan </span>option is the name of the name of the test plan configuration file under
<span 
class="ectt-1095">test_plan </span>folder.
<!--l. 928--><p class="indent" >   For <span 
class="ecti-1095">PC-devices</span>, the additional options are as follows:
     <ul class="itemize1">
     <li class="itemize"><span 
class="ectt-1095">target_device</span>: The block device the image is flashed to.
     </li>
     <li class="itemize"><span 
class="ectt-1095">root_partition</span>: The partition to which the root of the image ends up after flashing
     the image. <span 
class="ecbx-1095">Note: </span>this option is only used if there is no disk layout configuration file in
     the AFT invocation folder.
                                                                                    

                                                                                    
     </li>
     <li class="itemize"><span 
class="ectt-1095">disk_layout_file</span>: The partition layout file name. Expected to be found in the working
     directory of AFT invocation.
     </li>
     <li class="itemize"><span 
class="ectt-1095">service_mode</span>: A pattern which can be used to verify that the device is in service mode,
     that is, ready to be flashed. Compared against <span 
class="ectt-1095">/proc/version</span>.
     </li>
     <li class="itemize"><span 
class="ectt-1095">test_mode</span>: Same as above but for the testing mode, that is, what is seen after the
     testable image has booted.
     </li>
     <li class="itemize"><span 
class="ectt-1095">service_mode_keystrokes</span>: The keyboard sequence which switches the BIOS options
     to service mode.
     </li>
     <li class="itemize"><span 
class="ectt-1095">test_mode_keystrokes</span>: Same as above but for testing mode.</li></ul>
<!--l. 945--><p class="indent" >   For <span 
class="ecti-1095">Edison </span>devices there are no extra device specific options.
<!--l. 947--><p class="indent" >   For <span 
class="ecti-1095">serial recording</span>, the add option:
     <ul class="itemize1">
     <li class="itemize"><span 
class="ectt-1095">serial_bauds</span>: The baudrate of the serial connection.</li></ul>
<!--l. 952--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-45000A.1"></a>devices/topology.cfg</h5>
<!--l. 954--><p class="noindent" >The <span 
class="ectt-1095">topology.cfg </span>file contains individual physical device specific information. The options you have
to specify here depend on the device type and the power cutter used with it.
<!--l. 956--><p class="indent" >   The mandatory options for all devices are the <span 
class="ectt-1095">model </span>and <span 
class="ectt-1095">id</span>. The information required to
construct a cutter instance specific to the device is also almost certainly required.
<!--l. 958--><p class="indent" >   The <span 
class="ectt-1095">model </span>is the device model. This is used to determine which device type from <span 
class="ectt-1095">catalog.cfg </span>is
associated with the physical device.
<!--l. 960--><p class="indent" >   The <span 
class="ectt-1095">id </span>is a unique identifier which is used as the name of the lock file associated with the device,
when the device is in use. For PC-devices this should be the MAC-address. For Edisons this can be
anything that is unique.
<!--l. 962--><p class="indent" >   The options related to <span 
class="ecti-1095">Clewarecutters </span>are as follows:
     <ul class="itemize1">
     <li class="itemize"><span 
class="ectt-1095">cutter</span>: The ID of the cutter. This is taped on each cutter but can be also found using
     the <span 
class="ectt-1095">clewarecontrol </span>tool
     </li>
     <li class="itemize"><span 
class="ectt-1095">channel</span>: The power socket of the cutter specified with <span 
class="ectt-1095">cutter</span>.</li></ul>
<!--l. 968--><p class="indent" >   For <span 
class="ecti-1095">usbrelays </span>the only required option is <span 
class="ectt-1095">cutter</span>. This specifies the ttyUSB device associated
with the cutter.
<!--l. 970--><p class="indent" >   For <span 
class="ecti-1095">PC-devices </span>the mandatory options are as follows:
     <ul class="itemize1">
     <li class="itemize"><span 
class="ectt-1095">pem_interface</span>: the interface used with PEM. The only option at the time of writing is
     serialconnection.
                                                                                    

                                                                                    
     </li>
     <li class="itemize"><span 
class="ectt-1095">pem_port</span>:  The  ttyUSB  device  for  the  USB-to-serial  adapter  connected  to  the
     PEM-Arduino.</li></ul>
<!--l. 976--><p class="indent" >   For <span 
class="ecti-1095">Edisons </span>the mandatory options are as follows:
     <ul class="itemize1">
     <li class="itemize"><span 
class="ectt-1095">edison_usb_port</span>: The USB-bus and -port to which the USB-cable to Edison is attached.
     <span 
class="ecbx-1095">Note: </span>Not the usbrelay but the cable.
     </li>
     <li class="itemize"><span 
class="ectt-1095">network_subnet</span>: A *.*.*.*/30 subnet dedicated for this specific Edison device.</li></ul>
<!--l. 983--><p class="indent" >   For <span 
class="ecti-1095">serial recording </span>the mandatory additional options are:
     <ul class="itemize1">
     <li class="itemize"><span 
class="ectt-1095">serial_port</span>: The ttyUSB device attached to the serial port of the target device.</li></ul>
<!--l. 989--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-46000A.1"></a>aft.cfg</h5>
<!--l. 990--><p class="noindent" >The <span 
class="ectt-1095">aft.cfg </span>is the global configuration file used to specify settings that affect the behaviour of AFT
itself.
<!--l. 992--><p class="indent" >   The <span 
class="ectt-1095">lock_file </span>option is the directory into which lock files can be created by users in <span 
class="ecti-1095">lock </span>group.
For example on OpenSUSE this is <span 
class="ectt-1095">/var/lock</span>, while on Fedora it is <span 
class="ectt-1095">/var/lock/lockdev</span>.
<!--l. 994--><p class="indent" >   The <span 
class="ectt-1095">serial_log_name </span>is the filename to which serial output is recorded under the AFT working
directory.
<!--l. 996--><p class="indent" >   The <span 
class="ectt-1095">aft_log_name </span>is the filename to which internal AFT log messages are stored.
<!--l. 998--><p class="indent" >   The <span 
class="ectt-1095">nfs_folder </span>is the folder which is exported using NFS, and visible to the devices under
test.
<!--l. 1000--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-47000A.1"></a>test_plan</h5>
<!--l. 1001--><p class="noindent" >The <span 
class="ectt-1095">test_plan </span>folder contains configuration for each test plan. In a configuration file each section
define one AFT test case with the parameter <span 
class="ectt-1095">test_case </span>and the settings for that test. The
<span 
class="ectt-1095">test_case </span>is associated with the correct test class by the <span 
class="ecti-1095">testcasefactory</span>.
<!--l. 1003--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">A.2   </span> <a 
 id="x1-48000A.2"></a>Classes and files</h4>
<!--l. 1005--><p class="noindent" >AFT is aimed to be as easy to deploy as reasonably possible. Because it is also intended to
be flexible and suitable for other projects, the code is also kept as simple and short as
possible.
                                                                                    

                                                                                    
<!--l. 1007--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-49000A.2"></a>setup.py</h5>
<!--l. 1008--><p class="noindent" >The installation module. This file is responsible of deploying all AFT-related items, creating entry
points and deploying example configuration files if they don&#8217;t exist already.
<!--l. 1010--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-50000A.2"></a>device.py</h5>
<!--l. 1011--><p class="noindent" ><span 
class="ecti-1095">Device </span>is an abstract base class to define an interface for all device types. It requires the
implementation of <span 
class="ectt-1095">write_image </span>and <span 
class="ectt-1095">get_ip </span>methods. The <span 
class="ectt-1095">write_image </span>should execute all the steps
required for flashing the image. The <span 
class="ectt-1095">get_ip </span>should return an IP-address that is guaranteed to work
for SSH-connection on the device instance.
<!--l. 1013--><p class="indent" >   In addition, the <span 
class="ectt-1095">test </span>method should set the device and host to be ready to execute the
testing, and then <span 
class="ectt-1095">return test_case.run(self)</span>. This is the visited method in a visitor
pattern.
<!--l. 1015--><p class="indent" >   The <span 
class="ectt-1095">record_serial </span>method is in the <span 
class="ecti-1095">device </span>class because the serial port used for recording is
device-specific.
<!--l. 1017--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-51000A.2"></a>cutter.py</h5>
<!--l. 1018--><p class="noindent" ><span 
class="ecti-1095">Cutter </span>is an abstract base class to define an interface for all power cutters. It requires
the implementation of <span 
class="ectt-1095">connect </span>and <span 
class="ectt-1095">disconnect </span>methods, to power on and off a power
cutter.
<!--l. 1020--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-52000A.2"></a>devicefactory.py and testcasefactory.py</h5>
<!--l. 1021--><p class="noindent" >Factory modules to construct devices and testcases. These are the only locations where there should
be string-to-Python-class conversion.
<!--l. 1023--><p class="indent" >   This is preferred over a perhaps more elegant <span 
class="ectt-1095">setuptools entrypoint </span>method for the addition
of modules to AFT to keep the codebase simpler. The entrypoint methodology requires somewhat
complicated installation method in the extension modules.
<!--l. 1025--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-53000A.2"></a>testcase.py</h5>
<!--l. 1026--><p class="noindent" ><span 
class="ecti-1095">TestCase </span>is an abstract base class to define an interface for all AFT test cases. These can for
example call an external testrunner with options or run a simple test case themself.
<!--l. 1028--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-54000A.2"></a>config.py</h5>
<!--l. 1029--><p class="noindent" >A module used for parsing global configuration file <span 
class="ectt-1095">/etc/aft/aft.cfg</span>. The values are set as module
attributes so that they can be referred using <span 
class="ecti-1095">aft.config.OPTION </span>syntax. Also sets sensible default
values.
                                                                                    

                                                                                    
<!--l. 1031--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-55000A.2"></a>main.py</h5>
<!--l. 1032--><p class="noindent" >The entry point to AFT. The high-level execution sequence is
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">Construct all devices of the requested type
     </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">Reserve a device for this specific execution
     </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">Prepare the AFT test runner
     </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">Flash the image
     </dd><dt class="enumerate-enumitem">
   5. </dt><dd 
class="enumerate-enumitem">Execute the test runner and run the tests</dd></dl>
<!--l. 1041--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-56000A.2"></a>tools</h5>
<!--l. 1042--><p class="noindent" >General tools and subprocesses for AFT. This provides for example a safe subprocess execution call
with timeout for both the testing harness and device under test.
<!--l. 1044--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-57000A.2"></a>default_config</h5>
<!--l. 1045--><p class="noindent" >Default example settings for the configuration files. Installed if they don&#8217;t exist under
<span 
class="ectt-1095">/etc/aft</span>.
<!--l. 1047--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-58000A.2"></a>devices</h5>
<!--l. 1048--><p class="noindent" >The device modules and their associated topology-generation modules.
<!--l. 1050--><p class="noindent" >
   <h5 class="likesubsubsectionHead"><a 
 id="x1-59000A.2"></a>cutters</h5>
<!--l. 1051--><p class="noindent" >Power cutter modules.
<!--l. 1053--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">B   </span> <a 
 id="x1-60000B"></a>AFT without root privileges</h3>
                                                                                    

                                                                                    
<!--l. 1056--><p class="noindent" >If none of the testable devices require actions which require root privileges, e.g. <span 
class="ectt-1095">mount </span>on the testing
harness, AFT can be run without root privileges. In other words, if only PC-devices are used in the
testing system, AFT can be run with lowered privileges.
<!--l. 1058--><p class="indent" >   The privileges that are mandatory for AFT are access to serial devices and the ability to lock
files. The corresponding user groups on OpenSUSE are <span 
class="ectt-1095">dialout </span>and <span 
class="ectt-1095">lock</span>. These are easiest
to set using <span 
class="ectt-1095">yast </span>on the testing harness and setting the user used for testing to these
groups.
<!--l. 1060--><p class="indent" >   Additionally <span 
class="ectt-1095">clewarecontrol </span>always requires root privileges. By setting the <span 
class="ectt-1095">setuid </span>bit on the
executable makes the program always run on its <span 
class="ecti-1095">owner user</span>. Because the programs under <span 
class="ectt-1095">/usr/bin</span>
are owned by root, this provides the necessary privileges for those executions. The setuid bit can be
set by issuing as a root user: <!--l. 1061-->
<div class="lstlisting" id="listing-59"><span class="label"><a 
 id="x1-60001r1"></a><span 
class="ecrm-0600">1</span></span><span 
class="ecrm-0600">chmod</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">4755</span><span 
class="ecrm-0600">&#x00A0;</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">usr</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">bin</span><span 
class="ecrm-0600">/</span><span 
class="ecrm-0600">clewarecontrol</span>
   </div>
    
</body></html> 

                                                                                    


